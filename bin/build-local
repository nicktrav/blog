#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
SHA=$(git rev-parse HEAD)

# Build the project
mvn clean package

# Build dockerfiles and publsh locally
pushd "$DIR/.."
  docker build -t "nickt/blog-server:$SHA" -f "Dockerfile.server" .
  docker build -t "nickt/blog-nginx:$SHA" -f "Dockerfile.nginx" .
  docker tag "nickt/blog-server:$SHA" "nickt/blog-server"
  docker tag "nickt/blog-nginx:$SHA" "nickt/blog-nginx"
popd
